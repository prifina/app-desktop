(this["webpackJsonp@prifina-apps/desktop-app"]=this["webpackJsonp@prifina-apps/desktop-app"]||[]).push([[10],{528:function(e,t,n){"use strict";n.r(t);var r=n(31),c=n.n(r),a=n(46),i=n(14),o=n(19),s=n(4),u=n.n(s),l=n(320),p=n(8),f=n(173),d=n.n(f),O=n(157),j=n(7),b=n(75),g=n(92),h=n(48),m=n(309),v=n(332),x=n(321),P=n(3),y=function(e){var t=e.clientHandler,r=e.currentUser,f=e.activeUser,d=(e.API,Object(h.k)()),g=Object(j.useUserMenu)();console.log("CURRENT USER ",r);var y=Object(j.useIsMountedRef)(),E=Object(s.useReducer)((function(e,t){return Object(i.a)(Object(i.a)({},e),t)}),{appIcons:[],loadingStatus:!0}),w=Object(o.a)(E,2),A=w[0],C=w[1],N=Object(s.useRef)({}),S=Object(s.useState)([]),U=Object(o.a)(S,2),I=U[0],R=U[1],k=Object(s.useState)([]),M=Object(o.a)(k,2),H=M[0],T=M[1],J=Object(s.useRef)(null);Object(s.useRef)(null);Object(s.useEffect)((function(){function e(){return(e=Object(a.a)(c.a.mark((function e(){var n,a,i,o,s,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y.current){e.next=24;break}return e.next=3,Object(j.listAppMarketQuery)(b.a,{filter:{appType:{gt:1}}});case 3:return n=e.sent,console.log("APPS 2",n),a={},n.data.listAppMarket.items.forEach((function(e){a[e.id]=e,3===e.appType&&(a[e.id].route="core/"+e.route)})),console.log(N),(i=JSON.parse(r.installedApps)).forEach((function(e){N.current[e]=a[e]})),o=JSON.parse(r.appProfile),s=o.initials,console.log("APP PROFILE ",o),e.next=15,t.query({query:Object(O.default)(j.getNotificationCount),variables:{filter:{owner:{eq:r.id},status:{eq:0}}}});case 15:return u=e.sent,console.log("COUNT ",u),g.show({initials:s,effect:{hover:{width:42}},notifications:u.data.getNotificationCount,RecentApps:[]}),g.setClientHandler(t),g.setActiveUser(f),J.current=g.onUpdate,e.next=23,t.mutate({mutation:Object(O.default)(j.updateActivity),variables:{id:r.id,activeApp:"Home"}});case 23:T(i);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){}}),[y,r.id]),Object(s.useEffect)((function(){var e=null,t=!0,n=function(){t&&(clearTimeout(e),e=setTimeout((function(){console.log("RESIZE ",window.innerHeight),R([])}),150))};return window.addEventListener("resize",n),function(){t=!1,window.removeEventListener("resize",n)}}),[]),Object(s.useEffect)((function(){if(H.length>0){var e=H.map((function(e){return n(525)("./".concat(e,"Icon"))}));Promise.all(e).then((function(e){console.log("COMPONENT ",e);var t=e.map((function(e,t){return console.log("COMPONENT NAME ",e.default.displayName),{component:Object(P.jsx)("div",{children:Object(P.jsx)(e.default,{})},"app-"+t),name:e.default.displayName}}));console.log("IMPORT APP ICONS...",t),C({loadingStatus:!1,appIcons:t})}))}}),[H]);var L=A.loadingStatus,q=A.appIcons;console.log("APP ICONS ",q,100*q.length);var D=Math.ceil(115*q.length/(window.innerHeight-130)),F="1fr";D>0&&(F+=" 80px".repeat(D)),console.log(D,F,q.length);var z,B,K=Array(q.length).fill(0).map((function(e,t){return t+1})).filter((function(e,t){return console.log(e,t,115*e),115*e>window.innerHeight-130}))[0];console.log("maxColHeight... ",K-1),console.log("CHECK ",q.length>0,0===I.length),isNaN(K)&&(K=q.length),q.length>0&&0===I.length&&R((z=q,B=K-1,Array(Math.ceil(z.length/B)).fill().map((function(e,t){return t*B})).map((function(e){return z.slice(e,e+B)})))),I.length>0&&I.map((function(e,t){console.log(e,t)})),console.log("APPS ",N.current);var Q=Object(x.useSpring)({opacity:1,from:{opacity:0},config:{duration:3e3}}).opacity;return Object(P.jsxs)(u.a.Fragment,{children:[Object(P.jsx)("button",{onClick:function(){},children:"SUBS..."}),Object(P.jsxs)(m.b,{children:[Object(P.jsx)(v.a,{}),Object(P.jsxs)(m.a,{children:[L&&Object(P.jsx)("div",{}),!L&&Object(P.jsx)(x.animated.div,{style:{opacity:Q.interpolate((function(e){return e>.6?1:e}))},children:Object(P.jsx)(p.Box,{m:8,mt:77,style:{zIndex:3},children:Object(P.jsx)(l.CssGrid,{columns:F,flow:"column",children:I.length>0&&I.map((function(e,t){return e.map((function(n,r){return Object(P.jsx)(l.CssCell,{left:I.length-t+1,top:e.length-r,style:{cursor:"pointer"},onClick:function(){console.log("APP CLICK ",N.current[n.name].route),d.push("/"+N.current[n.name].route)},children:n.component},"cell-"+t+"-"+r)}))}))})})})]})]})]})},E=function(e){Object(h.k)();var t=Object(j.useAppContext)(),n=(t.userAuth,t.currentUser);console.log("HOME ",n);var r=Object(s.useRef)(null),i=Object(s.useRef)(null),u=Object(s.useState)(!1),l=Object(o.a)(u,2),p=l[0],O=l[1],m=Object(s.useRef)({});return Object(s.useEffect)(Object(a.a)(c.a.mark((function e(){var t,a,o,s,u,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(n).length>0)){e.next=20;break}return e.next=3,Object(j.getPrifinaUserQuery)(b.a,n.prifinaID);case 3:if(t=e.sent,a=JSON.parse(t.data.getPrifinaUser.appProfile),o="",s="",a.hasOwnProperty("endpoint")){e.next=13;break}return e.next=10,Object(j.updateUserProfileMutation)(b.a,n.prifinaID);case 10:u=e.sent,console.log("PROFILE UPDATE ",u),a=JSON.parse(u.data.updateUserProfile.appProfile);case 13:o=a.endpoint,s=a.region,c=o,p=s,g.a.currentCredentials().then((function(e){console.log("HOME USER CLIENT ",e)})),l=new d.a({url:c,region:p,auth:{type:f.AUTH_TYPE.AWS_IAM,credentials:function(){return g.a.currentCredentials()}},disableOffline:!0}),i.current=t.data.getPrifinaUser,m.current={name:a.name,uuid:n.prifinaID,endpoint:o,region:s},r.current=l,O(!0);case 20:case"end":return e.stop()}var c,p}),e)}))),[n]),Object(P.jsxs)(P.Fragment,{children:[p&&Object(P.jsx)(y,{clientHandler:r.current,currentUser:i.current,activeUser:m.current}),!p&&Object(P.jsx)("div",{})]})};E.displayName="Home",t.default=Object(j.withUsermenu)()(E)}}]);
//# sourceMappingURL=10.a78a816e.chunk.js.map